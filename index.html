<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Smart Flashcards</title>
    <link rel="stylesheet" href="styles.css?v=6">
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Smart Flashcards</h1>
            <p class="subtitle">AI-powered learning with spaced repetition</p>
            <div style="margin-top: 10px; display: flex; gap: 10px; justify-content: center;">
                <button onclick="toggleSettings()" style="background: #2a2a2a; color: #e0e0e0; border: 1px solid #444; font-size: 0.9em; padding: 8px 16px; border-radius: 8px; cursor: pointer;">‚öôÔ∏è Settings</button>
                <button onclick="logout()" style="background: #2a2a2a; color: #e0e0e0; border: 1px solid #444; font-size: 0.9em; padding: 8px 16px; border-radius: 8px; cursor: pointer;">üö™ Logout</button>
            </div>
        </header>

        <!-- Toast Notification -->
        <div id="toast" class="toast"></div>

        <!-- Login Section -->
        <div id="auth-section" class="section">
            <h2>üîê Login</h2>
            <form onsubmit="event.preventDefault(); login();">
                <div style="margin-bottom: 15px;">
                    <input type="email" id="login-email" placeholder="Email" style="width: 100%; padding: 12px; border: 2px solid #333; border-radius: 8px; background: #0a0a0a; color: #e0e0e0; margin-bottom: 10px;">
                    <input type="password" id="login-password" placeholder="Password" style="width: 100%; padding: 12px; border: 2px solid #333; border-radius: 8px; background: #0a0a0a; color: #e0e0e0;">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="primary-btn" style="flex: 1;">Login</button>
                    <button type="button" onclick="signup()" class="secondary-btn" style="flex: 1;">Sign Up</button>
                </div>
            </form>
            <p class="hint">Your flashcards are stored securely in your account</p>
        </div>

        <!-- API Key Setup -->
        <div id="setup-section" class="section hidden">
            <h2>Setup</h2>
            <form onsubmit="event.preventDefault(); saveApiKey();">
                <div class="input-group">
                    <input type="password" id="api-key" placeholder="Enter your OpenAI API key" autocomplete="off">
                    <button type="submit">Save Key</button>
                </div>
            </form>
            <p class="hint">Your API key syncs across all your devices via Firebase</p>
            
            <div style="margin-top: 20px;">
                <label for="model-select" style="display: block; margin-bottom: 8px; font-weight: 600;">AI Model:</label>
                <select id="model-select" onchange="saveModel()" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;">
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast, Cheap)</option>
                    <option value="gpt-4o-mini">GPT-4o Mini (Balanced)</option>
                    <option value="gpt-4o">GPT-4o (Best Quality)</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo (Premium)</option>
                </select>
                <p class="hint">Cheaper models work fine for flashcards. Change if you hit rate limits.</p>
            </div>
        </div>

        <!-- Flashcard Management -->
        <div id="deck-section" class="section hidden">
            <h2>üé¥ Your Deck</h2>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">Total Cards:</span>
                    <span id="total-cards">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Due Today:</span>
                    <span id="due-cards">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Mastered:</span>
                    <span id="mastered-cards">0</span>
                </div>
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
                <button onclick="startQuiz()" class="primary-btn" style="flex: 1; min-width: 200px;">Start Learning</button>
                <button onclick="viewAllCards()" class="secondary-btn" style="flex: 1; min-width: 150px;">View All Cards</button>
                <button onclick="showGenerateSection()" class="secondary-btn" style="flex: 1; min-width: 150px;">ü§ñ Generate with AI</button>
            </div>
            <p id="sync-status" style="font-size: 0.85em; color: #888; text-align: center;"></p>
        </div>

        <!-- Text Input Section (Hidden by default) -->
        <div id="input-section" class="section" style="display: none !important;">
            <h2>ü§ñ Generate Flashcards with AI</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;"></div>
                <div>
                    <label for="model-select-main" style="display: block; margin-bottom: 8px; font-weight: 600; color: #888;">AI Model:</label>
                    <select id="model-select-main" onchange="saveModelMain()" style="width: 100%; padding: 10px; border: 2px solid #333; border-radius: 8px; font-size: 0.95em; background: #0a0a0a; color: #e0e0e0;">
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast, Cheap)</option>
                        <option value="gpt-4o-mini">GPT-4o Mini (Balanced)</option>
                        <option value="gpt-4o">GPT-4o (Best Quality)</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo (Premium)</option>
                    </select>
                </div>
                <div>
                    <label for="card-count" style="display: block; margin-bottom: 8px; font-weight: 600; color: #888;">Number of Cards:</label>
                    <input type="number" id="card-count" min="1" max="20" value="5" style="width: 100%; padding: 10px; border: 2px solid #333; border-radius: 8px; font-size: 0.95em; background: #0a0a0a; color: #e0e0e0;">
                </div>
            </div>
            
            <textarea id="text-input" placeholder="Paste your text here (article, notes, etc.)..."></textarea>
            <button onclick="generateFlashcards()" class="primary-btn">Generate Flashcards</button>
            <div id="loading" class="hidden">Generating flashcards...</div>
            <button onclick="closeGenerateSection()" class="secondary-btn" style="margin-top: 15px;">Close</button>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-section" class="section hidden">
            <div class="quiz-header">
                <h2>Learning Session</h2>
                <div class="difficulty-badge" id="difficulty-badge">Easy</div>
            </div>
            <div id="quiz-card" class="flashcard">
                <div class="card-front" id="card-question"></div>
                <div class="card-back hidden" id="card-answer"></div>
                <button onclick="flipCard()" class="flip-btn">Show Answer</button>
            </div>
            <div id="quiz-controls" class="hidden">
                <button onclick="rateCard(1)" class="rate-btn hard">Hard</button>
                <button onclick="rateCard(3)" class="rate-btn good">Good</button>
                <button onclick="rateCard(5)" class="rate-btn easy">Easy</button>
            </div>
            <button onclick="endQuiz()" class="secondary-btn">End Session</button>
        </div>

        <!-- Card List View -->
        <div id="list-section" class="section hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">All Cards</h2>
                <button onclick="showAddCardForm()" class="primary-btn" style="padding: 8px 16px;">+ Add Card</button>
            </div>
            
            <!-- Add Card Form -->
            <div id="add-card-form" class="hidden" style="background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin-top: 0;">Add New Card</h3>
                <input type="text" id="new-question" placeholder="Question" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                <textarea id="new-answer" placeholder="Answer" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 2px solid #e0e0e0; border-radius: 8px; min-height: 80px;"></textarea>
                <div style="display: flex; gap: 10px;">
                    <button onclick="addCard()" class="primary-btn">Save Card</button>
                    <button onclick="cancelAddCard()" class="secondary-btn">Cancel</button>
                </div>
            </div>
            
            <div id="card-list"></div>
            <button onclick="closeCardList()" class="secondary-btn">Close</button>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
